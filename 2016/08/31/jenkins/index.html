<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      Jenkins + Git持续集成部署 | Raymon 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="lemin">
    
    

    <meta name="description" content="JenkinsJenkins是一个开源的自动化集成部署工具，提供上百种插件，支持各种类型的工程的集成，可扩展性非常的强，功能也十分完善，是一款非常优秀的自动部署工具">
<meta property="og:type" content="article">
<meta property="og:title" content="Jenkins + Git持续集成部署 | Raymon">
<meta property="og:url" content="http://yoursite.com/2016/08/31/jenkins/index.html">
<meta property="og:site_name" content="Raymon">
<meta property="og:description" content="JenkinsJenkins是一个开源的自动化集成部署工具，提供上百种插件，支持各种类型的工程的集成，可扩展性非常的强，功能也十分完善，是一款非常优秀的自动部署工具">
<meta property="og:image" content="http://yoursite.com/images/jenkins/1.jpg">
<meta property="og:image" content="http://yoursite.com/images/jenkins/2.jpg">
<meta property="og:image" content="http://yoursite.com/images/jenkins/3.jpg">
<meta property="og:image" content="http://yoursite.com/images/jenkins/4.jpg">
<meta property="og:updated_time" content="2017-05-19T12:59:03.504Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jenkins + Git持续集成部署 | Raymon">
<meta name="twitter:description" content="JenkinsJenkins是一个开源的自动化集成部署工具，提供上百种插件，支持各种类型的工程的集成，可扩展性非常的强，功能也十分完善，是一款非常优秀的自动部署工具">
<meta name="twitter:image" content="http://yoursite.com/images/jenkins/1.jpg">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        
        <a href="/" title="link to homepage for Raymon"><img src="/avatar.png" width="80" alt="Raymon logo" class="panel-cover__logo logo" /></a>
        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Raymon</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          zero to hero
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">Jenkins + Git持续集成部署</h1>

    

    <div class="post-meta">
      <time datetime="2016-08-31" class="post-meta__date date">2016-08-31</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/jenkins/">jenkins</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h3 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h3><p>Jenkins是一个开源的自动化集成部署工具，提供上百种插件，支持各种类型的工程的集成，可扩展性非常的强，功能也十分完善，是一款非常优秀的自动部署工具</p>
<a id="more"></a>
<ul>
<li><strong> 背景 </strong> : 刚入职新公司时，上级给我介绍公司的开发流程时，说到部署服务器时居然需要本地将项目打包好然后通过ftp将war包传到服务器上，然后再手动重启tomcat，这让我非常不理解(因为上家公司就是使用的jenkins部署项目)，这样一次流程不仅非常麻烦而且手动操作容易出现问题，一天如果多次上线将会非常影响开发效率，因此我利用空余时间搭建了jenkins环境，改为一键部署，甚至可以监控gitlab实时部署(不推荐)，为我们小组节约了许多的开发时间。</li>
</ul>
<hr>
<ul>
<li><p><strong> 环境 </strong> : CentOS release 6.5 (Final)，JDK1.7，Tomcat，Maven, Git</p>
</li>
<li><p><strong> 步骤 </strong> : </p>
</li>
</ul>
<ol>
<li><h4 id="服务器上安装git"><a href="#服务器上安装git" class="headerlink" title=" 服务器上安装git "></a><strong> 服务器上安装git </strong></h4> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install git --服务器有包管理工具yum，linux环境还可以用apt-get</div></pre></td></tr></table></figure>
<p> 可以直接从系统包管理器安装，但是拉下来的版本会非常的低，我们需要升级一下~<br> 使用rpm的强大功能，从以下的地址中，导入安装所需要的证书，命令如:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm --import http://apt.sw.be/RPM-GPG-KEY.dag.txt</div></pre></td></tr></table></figure>
<p> 因为yum命令下载的软件依赖于其所使用的软件仓库，所以我们只要更改其指定的软件仓库，就能使用yum来方便地下载安装RPMForge源中的软件来更新本机的软件，从而简化安装操作。其命令如下</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum --enablerepo=rpmforge-extras update</div></pre></td></tr></table></figure>
<p> 这时你会看到有大量的软件更新，因为我们只需要更新git，所以选择’N’,不全部安装；<br> 查看可用的git模块</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum --enablerepo=rpmforge-extras provides git </div><div class="line">yum --enablerepo=rpmforge-extras install gitk-1.7.12.4-1.el6.rfx.i686.rpm</div></pre></td></tr></table></figure>
<p> 此时我们的git就升级好了，我们可以命令查看版本：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git --version</div></pre></td></tr></table></figure>
</li>
<li><h4 id="安装jenkins服务器"><a href="#安装jenkins服务器" class="headerlink" title=" 安装jenkins服务器 "></a><strong> 安装jenkins服务器 </strong></h4><p> 首先下载jenkins.war包，我们使用的是2.0版本，可以直接下到tmp里：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://mirrors.jenkins-ci.org/war/2.0/jenkins.war</div></pre></td></tr></table></figure>
<p> 下好之后，我们使用命令启动服务器(因为8080端口已被tomcat占用，我们需要换一个端口号)：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -jar jenkins.war --httpPort=9000</div></pre></td></tr></table></figure>
<p> 这样启动jenkins后有个问题就是命令窗口不能关掉，一关掉就会导致进程被杀死，大叔让我装了个screen(也不知道啥原理)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install screen</div><div class="line"></div><div class="line">screen</div><div class="line">java -jar jenkins.war --httpPort=9000</div></pre></td></tr></table></figure>
<p> 这样启动即可后台运行。<br> Jenkins启动后会初始化目录，默认目录是root下的.jenkins目录，最好不要修改，否则可能导致服务起不来，然后进入到<a href="http://host:port/" target="_blank" rel="external">http://host:port/</a> 选择安装的插件，选择完我们需要的插件，等待安装完毕。</p>
</li>
<li><h4 id="jenkins基础配置"><a href="#jenkins基础配置" class="headerlink" title=" jenkins基础配置 "></a><strong> jenkins基础配置 </strong></h4><p> 配置maven，jdk，git地址<br> <img src="/images/jenkins/1.jpg" alt=""></p>
<p> 配置maven home<br> <img src="/images/jenkins/2.jpg" alt=""></p>
</li>
<li><h4 id="jenkins新建job"><a href="#jenkins新建job" class="headerlink" title=" jenkins新建job "></a><strong> jenkins新建job </strong></h4><p> 选择构建一个自由风格的软件项目<br> 进入到配置页面填写对应的配置信息<br> 配置git源码管理，可以让jenkins拉取到仓库最新代码：<br> <img src="/images/jenkins/3.jpg" alt=""><br> Credentials这项需要我们去Jenkins的Credentials System里配置我们的gitLab帐号，这里就不多说了；</p>
<p> 配置构建流程<br> 首先使用maven进行项目打包，这里我们只需要简单的clean install即可，但必须保证整个项目是可以在本地clean install成功的：<br> <img src="/images/jenkins/4.jpg" alt=""></p>
<p> maven构建成功后，我们需要把build出来的最新的war包放到tomcat的服务器里，并重启tomcat服务，我们需要在构建流程里增加Executor Shell通过shell脚本执行命令实现自动化，这里分享下我的脚本：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">BUILD_ID=DONTKILLME</div><div class="line">TOMCAT_HOME=&quot;/home/apache-tomcat-7.0.68&quot;</div><div class="line">JENKINS_PATH=&quot;/var/lib/jenkins/jobs/windcloud/workspace/WindCloud&quot;</div><div class="line">TOMCAT_PORT=8080</div><div class="line">PROJECT=&quot;WindCloud&quot;</div><div class="line">JENKINS_JOB=&quot;windcloud&quot;</div><div class="line"># BAK_DIR=/opt/war/bak/$PROJECT/`date +%Y%m%d`</div><div class="line"></div><div class="line">#shutdown tomcat</div><div class="line">$&#123;TOMCAT_HOME&#125;/bin/shutdown.sh</div><div class="line">echo &quot;tomcat shutdown&quot;</div><div class="line"></div><div class="line">TOMCAT_PID=`lsof -n -P -t -i:$&#123;TOMCAT_PORT&#125;`</div><div class="line">echo &quot;current tomcat pid :&quot; $&#123;TOMCAT_PID&#125;</div><div class="line"> </div><div class="line">if [ -n &quot;$&#123;TOMCAT_PID&#125;&quot; ] ; then</div><div class="line">sleep 2 </div><div class="line">echo &quot;scan tomcat pid :&quot; $&#123;TOMCAT_PID&#125; </div><div class="line">kill -9 $&#123;TOMCAT_PID&#125;</div><div class="line">echo &quot;killed tomcat process!&quot;</div><div class="line">fi</div><div class="line">sleep 2</div><div class="line"></div><div class="line">publish project </div><div class="line">rm -rf $&#123;TOMCAT_HOME&#125;/webapps/$&#123;PROJECT&#125;</div><div class="line">rm -rf $&#123;TOMCAT_HOME&#125;/webapps/$&#123;PROJECT&#125;.war</div><div class="line">cp $&#123;JENKINS_PATH&#125;/target/$&#123;PROJECT&#125;.war $&#123;TOMCAT_HOME&#125;/webapps/$&#123;PROJECT&#125;.war</div><div class="line">#api</div><div class="line"># cd /root/.jenkins/workspace/$&#123;JENKINS_JOB&#125;/$&#123;PROJECT&#125;/src/main/java/com/mrwind/windCloud/</div><div class="line"># apidoc -i controller/ -o apidoc/</div><div class="line"># cp -rf apidoc /home/apache-tomcat-7.0.68/webapps/</div><div class="line">#start tomcat</div><div class="line">cd $&#123;TOMCAT_HOME&#125;/bin</div><div class="line">bash ./startup.sh</div><div class="line">echo &quot;tomcat is starting!&quot;</div></pre></td></tr></table></figure>
</li>
<li><h4 id="构建项目"><a href="#构建项目" class="headerlink" title=" 构建项目 "></a><strong> 构建项目 </strong></h4><p> 到这时候我们就可以算是实现自动化部署了，只要点一下立即构建，jenkins就会去拉取我们的指定分支的最新代码，进行自动打包并重启服务。我们可以进到构建进程里查看jenkins log：console-output，跑完没有出错就是构建成功了。</p>
</li>
<li><h4 id="jenkins-启动"><a href="#jenkins-启动" class="headerlink" title=" jenkins 启动 "></a><strong> jenkins 启动 </strong></h4><p> 通过运行jenkins.war启动jenkins，会导致无法退出线程，需要将线程挂起，需要使用service命令启动(配置在/etc/init.d/jenkins)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service jenkins restart</div></pre></td></tr></table></figure></li>
</ol>

  </section>

  
  
  
    
<section class="post-comments">

    <div class="ds-thread" data-thread-key="2016/08/31/jenkins/"></div>

    <!-- UY BEGIN -->
    <div id="uyan_frame"></div>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js"></script>
    <!-- UY END -->

</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2017. Raymon ❤️ Sunny | Huno</span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    
    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?1ebdc2e5c3ef0e1ca01b5ed227ddd88f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

    

    <script src="/js/jquery.githubRepoWidget.min.js"></script>


    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
